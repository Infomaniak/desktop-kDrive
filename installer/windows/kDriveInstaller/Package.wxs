<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Package Id="Infomaniak_Network_SA.kDriveInstaller" Name="kDrive" Manufacturer="Infomaniak Network SA" Version="$(shortVersion).0" InstallerVersion="301">
    <MajorUpgrade DowngradeErrorMessage="!(loc.DowngradeError)" />
    <MediaTemplate EmbedCab="yes" />
    <Feature Id="Main">
      <ComponentGroupRef Id="DLLComponents" />
      <ComponentGroupRef Id="thirdPartyExeComponents" />
      <ComponentGroupRef Id="SyncExcludeComponents" />
      <ComponentGroupRef Id="QTDLL" />
      <ComponentGroupRef Id="I18NComponents" />
      <ComponentGroupRef Id="ImageFormatsComponents" />
      <ComponentGroupRef Id="IconEnginesComponents" />
      <ComponentGroupRef Id="NetworkInformationComponents" />
      <ComponentGroupRef Id="PlatformsComponents" />
      <ComponentGroupRef Id="TLSComponents" />
      <ComponentGroupRef Id="TranslationsComponents" />
      <ComponentGroupRef Id="PositionComponents" />
      <ComponentGroupRef Id="RessourcesComponents" />
      <ComponentGroupRef Id="StyleComponents" />
      <ComponentGroupRef Id="ShellExtComponents" />
    </Feature>
    <CustomAction Id="InstallExplorerExtension"
                  Directory="System64Folder"
                  ExeCommand="WindowsPowerShell\v1.0\powershell.exe -NoLogo -NonInteractive -InputFormat None -NoProfile -Commande &quot;Add-AppxPackage [SHELLEXTFOLDER]FileExplorerExtensionPackage_$(shortVersion).0_x64_arm64.msixbundle  -ForceApplicationShutdown -ForceUpdateFromAnyVersion&quot;" 
                  Execute="deferred" 
                  Impersonate="no" 
                  Return="asyncWait"/>
    <CustomAction Id="UninstallExplorerExtension"
                  Directory="System64Folder"
                  ExeCommand="WindowsPowerShell\v1.0\powershell.exe -NoLogo -NonInteractive -InputFormat None -NoProfile -File &quot;[SHELLEXTFOLDER]Uninstall.ps1&quot;" 
                  Execute="deferred"
                  Impersonate="no"
                  Return="asyncWait"/>
    <InstallExecuteSequence>
      <Custom Action="InstallExplorerExtension" Before="InstallFinalize" Condition="NOT REMOVE=&quot;ALL&quot;"/>
      <Custom Action="UninstallExplorerExtension" Before="InstallFinalize" Condition="REMOVE=&quot;ALL&quot;"/>
    </InstallExecuteSequence>
  </Package>
</Wix>
