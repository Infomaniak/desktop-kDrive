name: Update branch marked auto merge

on:
    # Runs every 15 minutes
    schedule:
        - cron: '0/1 * * * *' # change to 15 minutes
    pull_request:
      branches-ignore:
        - 'main'

concurrency:
  group: auto-update
  cancel-in-progress: true

jobs:
  update-branch:
    if: ${{ github.event.pull_request.auto_merge }}
    runs-on: [ self-hosted, macOS, desktop-kdrive ]
    steps:
      - if: ${{ github.event.pull_request.auto_merge }}
        run: echo "Auto merge is enabled, updating branch"
      #- uses: lcdsmao/update-branch@v3
      #  with:
      #    requiredLabels: auto-merge
      #    requiredApprovals: 1

      - if: ${{ !github.event.pull_request.auto_merge }}
        run: echo "Auto merge is disabled"