<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="Infomaniak.kDrive.Pages.Onboarding.DriveSelectionPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Infomaniak.kDrive"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:controls="using:Infomaniak.kDrive.CustomControls"
      xmlns:converters="using:Infomaniak.kDrive.Converters"
      xmlns:viewmodels="using:Infomaniak.kDrive.ViewModels"
      xmlns:animatedvisuals="using:Microsoft.UI.Xaml.Controls.AnimatedVisuals"
      mc:Ignorable="d">

    <Page.Resources>
        <converters:BooleanToVisibilityConverter  x:Key="BooleanToVisibilityConverter" />
        <converters:BooleanToInvertedVisibilityConverter  x:Key="BooleanToInvertedVisibilityConverter" />
        <converters:BooleanToInvertedBooleanConverter  x:Key="BooleanToInvertedBooleanConverter" />
        <converters:IntegerToBooleanConverter  x:Key="IntegerToBooleanConverter" />
    </Page.Resources>

    <Grid HorizontalAlignment="Center"
          VerticalAlignment="Center"
          Margin="{StaticResource Infomaniak.Style.Thickness.Uniform.XXL}"
          RowSpacing="{StaticResource Infomaniak.Style.Spacing.XL}">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="auto" />
        </Grid.RowDefinitions>
        <Grid Grid.Row="0"
              RowSpacing="{StaticResource Infomaniak.Style.Spacing.L}">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <StackPanel Grid.Row="0"
                        Spacing="{StaticResource Infomaniak.Style.Spacing.S}">
                <!-- Title -->
                <TextBlock x:Uid="Page_Onboarding_DriveSelectionPage_Title"
                           Style="{StaticResource Infomaniak.Style.TextBlock.Title}"
                           Foreground="{ThemeResource TextFillColorPrimary}" />

                <!-- User info -->
                <StackPanel Orientation="Horizontal"
                            Spacing="12"
                            VerticalAlignment="Center">
                    <PersonPicture ProfilePicture="https://learn.microsoft.com/windows/uwp/contacts-and-calendar/images/shoulder-tap-static-payload.png"
                                   Height="24"
                                   Width="24" />
                    <TextBlock Text="{x:Bind ObViewModel.SelectedUser.Name}"
                               VerticalAlignment="Center"
                               Style="{StaticResource Infomaniak.Style.TextBlock.Body}" />
                </StackPanel>
            </StackPanel>
            <!-- No drive available -->
            <Grid Grid.Row="1"
                  RowSpacing="{StaticResource Infomaniak.Style.Spacing.M}"
                  Visibility="{x:Bind _onBoardingViewModel.SelectedUser.Drives.Count, Converter={StaticResource BooleanToInvertedVisibilityConverter}, Mode=OneWay}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="auto" />
                </Grid.RowDefinitions>

                <!-- Subtitle -->
                <TextBlock Grid.Row="0"
                           x:Uid="Page_Onboarding_DriveSelectionPage_NoDrive_Subtitle"
                           Style="{StaticResource Infomaniak.Style.TextBlock.BodySb}" />

                <!-- No drive text -->
                <TextBlock Grid.Row="1"
                           x:Uid="Page_Onboarding_DriveSelectionPage_NoDrive_Text"
                           Style="{StaticResource Infomaniak.Style.TextBlock.Body}"
                           TextWrapping="WrapWholeWords" />
            </Grid>

            <!-- Drive available -->
            <Grid Grid.Row="1"
                  RowSpacing="{StaticResource Infomaniak.Style.Spacing.M}"
                  Visibility="{x:Bind _onBoardingViewModel.SelectedUser.Drives.Count, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Subtitle -->
                <TextBlock Grid.Row="0"
                           x:Uid="Page_Onboarding_DriveSelectionPage_Subtitle"
                           Style="{StaticResource Infomaniak.Style.TextBlock.BodySb}" />

                <!-- List of drives -->
                <ListView x:Name="DriveList"
                          Grid.Row="1"
                          SelectionMode="None"
                          IsItemClickEnabled="False"
                          ItemsSource="{x:Bind ObViewModel.SelectedUser.Drives}">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:Drive">
                            <Grid Margin="{StaticResource Infomaniak.Style.Thickness.Top.XS}">
                                <ToolTipService.ToolTip>
                                    <ToolTip x:Uid="Page_Onboarding_DriveSelectionPage_DriveAlreadyConfigured"
                                             VerticalOffset="-80"
                                             IsEnabled="{x:Bind Syncs.Count, Converter={StaticResource IntegerToBooleanConverter}}" />
                                </ToolTipService.ToolTip>
                                <Border x:Name="DeactivatedTheme"
                                        Background="{ThemeResource SystemControlBackgroundBaseLowBrush}"
                                        Opacity="0.5"
                                        Visibility="{x:Bind Syncs.Count, Converter={StaticResource BooleanToVisibilityConverter}}"
                                        Style="{StaticResource Infomaniak.Style.Border.WithContent}">
                                </Border>

                                <Border Style="{StaticResource Infomaniak.Style.Border.WithContent}">
                                    <CheckBox Checked="DriveSelectedCheckBox_Checked"
                                              Unchecked="DriveSelectedCheckBox_Unchecked"
                                              HorizontalAlignment="Stretch"
                                              IsChecked="{x:Bind Syncs.Count, Converter={StaticResource IntegerToBooleanConverter}}"
                                              IsEnabled="{x:Bind Syncs.Count, Converter={StaticResource BooleanToInvertedBooleanConverter}}">
                                        <StackPanel Orientation="Horizontal">
                                            <controls:DriveIcon IconColor="{x:Bind Color}"
                                                                Height="14"
                                                                Margin="0,0,8,0" />
                                            <TextBlock Text="{x:Bind Name}"
                                                       Style="{StaticResource Infomaniak.Style.TextBlock.Body}" />
                                        </StackPanel>
                                    </CheckBox>
                                </Border>

                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>
        </Grid>

        <!-- Continue button -->
        <StackPanel Grid.Row="1"
                    Orientation="Horizontal"
                    Spacing="{StaticResource Infomaniak.Style.Spacing.XS}"
                    Visibility="{x:Bind _onBoardingViewModel.SelectedUser.Drives.Count, Converter={StaticResource BooleanToVisibilityConverter}, Mode=OneWay}">
            <Button x:Uid="Page_Onboarding_DriveSelectionPage_FinishButton"
                    HorizontalAlignment="Left"
                    Style="{StaticResource Infomaniak.Style.Button.WithBackground}"
                    IsEnabled="{x:Bind ObViewModel.NewSyncs.Count, Converter={StaticResource IntegerToBooleanConverter}, Mode=OneWay}"
                    Click="Finish_Click" />

            <Button x:Name="AdvancedButton"
                    x:Uid="Page_Onboarding_DriveSelectionPage_AdvancedButton"
                    HorizontalAlignment="Left"
                    Style="{StaticResource Infomaniak.Style.Button.WithoutBackground}"
                    Visibility="{x:Bind ObViewModel.NewSyncs.Count, Converter={StaticResource BooleanToVisibilityConverter} , Mode=OneWay}"
                    Click="AdvancedSettingsButton_Click" />
        </StackPanel>

        <!-- Offers Buttons -->
        <StackPanel Grid.Row="1"
                    Orientation="Horizontal"
                    Spacing="{StaticResource Infomaniak.Style.Spacing.XS}"
                    Visibility="{x:Bind _onBoardingViewModel.SelectedUser.Drives.Count, Converter={StaticResource BooleanToInvertedVisibilityConverter}, Mode=OneWay}">
            <Button x:Uid="Page_Onboarding_DriveSelectionPage_StartFreeButton"
                    HorizontalAlignment="Left"
                    Style="{StaticResource Infomaniak.Style.Button.WithBackground}"
                    Click="StartFree_Click" />

            <Button 
                    x:Uid="Page_Onboarding_DriveSelectionPage_OffersButton"
                    HorizontalAlignment="Left"
                    Style="{StaticResource Infomaniak.Style.Button.WithoutBackground}"
                    Click="OffersButton_Click" />
        </StackPanel>

        <!-- Advanced settings dialog -->
        <ContentDialog x:Name="AdvancedSettingsDialog"
                       x:Uid="Page_Onboarding_DriveSelectionPage_AdvancedDialog"
                       IsPrimaryButtonEnabled="False"
                       CloseButtonClick="AdvancedSettingsDialog_CloseButtonClick"
                       Opened="AdvancedSettingsDialog_Opened">
            <ContentDialog.Title>
                <TextBlock x:Uid="Page_Onboarding_DriveSelectionPage_AdvancedDialog_Title"
                           Style="{StaticResource Infomaniak.Style.TextBlock.Subtitle}" />
            </ContentDialog.Title>
            <Grid RowSpacing="{StaticResource Infomaniak.Style.Spacing.S}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="0"
                           x:Uid="Page_Onboarding_DriveSelectionPage_AdvancedDialog_Description"
                           TextWrapping="WrapWholeWords"
                           Style="{StaticResource Infomaniak.Style.TextBlock.Body}" />
                <InfoBar Grid.Row="1"
                         x:Uid="Page_Onboarding_DriveSelectionPage_AdvancedDialog_InfoBar"
                         IsOpen="True"
                         IsClosable="False"
                         Severity="Informational" />
                <ListView Grid.Row="2"
                          SelectionMode="None"
                          IsItemClickEnabled="False"
                          ItemsSource="{x:Bind ObViewModel.NewSyncs}">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:Sync">
                            <Border Margin="{StaticResource Infomaniak.Style.Thickness.Uniform.XS}">
                                <Grid ColumnSpacing="{StaticResource Infomaniak.Style.Spacing.XS}">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="auto" />
                                        <RowDefinition Height="auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="auto" />
                                    </Grid.ColumnDefinitions>

                                    <controls:DriveIcon Grid.Column="0"
                                                        Grid.Row="0"
                                                        Height="16"
                                                        VerticalAlignment="Center"
                                                        IconColor="{x:Bind Drive.Color}" />

                                    <TextBlock Grid.Column="1"
                                               Grid.Row="0"
                                               Text="{x:Bind Drive.Name}"
                                               HorizontalAlignment="Left"
                                               VerticalAlignment="Center"
                                               Style="{StaticResource Infomaniak.Style.TextBlock.Body}" />

                                    <TextBlock Grid.Column="1"
                                               Grid.Row="1"
                                               Text="{x:Bind LocalPath, Mode=OneWay}"
                                               HorizontalAlignment="Left"
                                               VerticalAlignment="Top"
                                               Style="{StaticResource Infomaniak.Style.TextBlock.Body}"
                                               Foreground="{ThemeResource TextBoxDisabledForegroundThemeBrush}"
                                               TextWrapping="Wrap" />

                                    <Button Grid.RowSpan="2"
                                            Grid.Column="2"
                                            x:Uid="Page_Onboarding_DriveSelectionPage_AdvancedDialog_CustomizeButton"
                                            Style="{StaticResource Infomaniak.Style.Button.WithoutBackground}"
                                            Click="ChangeSyncPathButton_Click" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
                <TeachingTip x:Name="FolderSelectionError"
                             x:Uid="Page_Onboarding_DriveSelectionPage_AdvancedDialog_TeachingTip"
                             IsLightDismissEnabled="True"
                             PlacementMargin="20"
                             PreferredPlacement="Auto">
                </TeachingTip>
            </Grid>
        </ContentDialog>
    </Grid>
</Page>
