<?xml version="1.0" encoding="utf-8"?>
<!--
 * Infomaniak kDrive - Desktop
 * Copyright (C) 2023-2025 Infomaniak Network SA
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see<http://www.gnu.org/licenses/> .
 -->

<Page x:Class="Infomaniak.kDrive.Pages.HomePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Infomaniak.kDrive.Pages"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:controls="using:Infomaniak.kDrive.CustomControls"
      xmlns:converters="using:Infomaniak.kDrive.Converters"
      xmlns:viewmodel="using:Infomaniak.kDrive.ViewModels"
      mc:Ignorable="d">
    <Page.Resources>
        <!-- Converters -->
        <converters:BooleanToInvertedVisibilityConverter  x:Key="BooleanToInvertedVisibilityConverter" />

        <!-- SyncStatus Text templates -->
        <DataTemplate x:Key="SyncUpToDateTemplate">
            <StackPanel Orientation="Horizontal"
                        Spacing="{StaticResource Infomaniak.Style.Spacing.S}">
                <TextBlock Style="{StaticResource Infomaniak.Style.TextBlock.Subtitle}">
                    <Run Text=", vos fichiers sont à jour" />
                </TextBlock>

                <ImageIcon Height="16"
                           Width="16">
                    <ImageIcon.Source>
                        <SvgImageSource UriSource="ms-appx:///Assets/Icons/circle-check-plain.svg" />
                    </ImageIcon.Source>
                </ImageIcon>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="SyncInProgressTemplate">
            <StackPanel Orientation="Horizontal"
                        Spacing="{StaticResource Infomaniak.Style.Spacing.S}">
                <TextBlock Style="{StaticResource Infomaniak.Style.TextBlock.Subtitle}">
                    <Run Text=", vos fichiers se synchronisent" />
                </TextBlock>

                <ImageIcon Height="16"
                           Width="16">
                    <ImageIcon.Source>
                        <SvgImageSource UriSource="ms-appx:///Assets/Icons/arrows-loop.svg" />
                    </ImageIcon.Source>
                </ImageIcon>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="SyncInPauseTemplate">
            <StackPanel Orientation="Horizontal"
                        Spacing="{StaticResource Infomaniak.Style.Spacing.S}">
                <TextBlock Style="{StaticResource Infomaniak.Style.TextBlock.Subtitle}">
            <Run Text=", la synchronisation est en pause" />
                </TextBlock>

                <ImageIcon Height="16"
                           Width="16">
                    <ImageIcon.Source>
                        <SvgImageSource UriSource="ms-appx:///Assets/Icons/pause-orange.svg" />
                    </ImageIcon.Source>
                </ImageIcon>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="SyncOfflineTemplate"
                      x:DataType="viewmodel:Sync">
            <StackPanel Orientation="Horizontal"
                        Spacing="{StaticResource Infomaniak.Style.Spacing.S}">
                <TextBlock Style="{StaticResource Infomaniak.Style.TextBlock.Subtitle}">
                    <Run Text=", la synchronisation est en pause" />
                </TextBlock>

                <ImageIcon Height="16"
                           Width="16">
                    <ImageIcon.Source>
                        <SvgImageSource UriSource="ms-appx:///Assets/Icons/cloud-offline.svg" />
                    </ImageIcon.Source>
                </ImageIcon>
            </StackPanel>
        </DataTemplate>

        <DataTemplate x:Key="SyncLoadingTemplate">

        </DataTemplate>

        <local:SyncStatusTemplateSelector x:Key="SyncStatusMessageTemplateSelector"
                                          SyncUpToDateTemplate="{StaticResource SyncUpToDateTemplate}"
                                          SyncInProgressTemplate="{StaticResource SyncInProgressTemplate}"
                                          SyncInPauseTemplate="{StaticResource SyncInPauseTemplate}"
                                          SyncOfflineTemplate="{StaticResource SyncOfflineTemplate}"
                                          SyncLoadingTemplate="{StaticResource SyncLoadingTemplate}" />

        <!-- SyncStatus main template-->
        <DataTemplate x:Key="SyncUpToDateMainTemplate">
            <Grid HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  RowSpacing="{StaticResource Infomaniak.Style.Spacing.XL}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <controls:LottiePlayer Grid.Row="0"
                                       UriSource="ms-appx:///Assets/Animations/kDrive-LoaderStroke.json"
                                       MaxWidth="230" />

                <StackPanel Grid.Row="1"
                            Spacing="{StaticResource Infomaniak.Style.Spacing.S}">
                    <!-- Title -->
                    <TextBlock Text="Pas d’activité en cours"
                               FontSize="16"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Margin="0,14,0,6" />

                    <!-- Description -->
                    <TextBlock Text="Vos fichiers sont accessibles et synchronisés."
                               FontSize="13"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               Margin="32,0,32,6" />

                    <!-- Link -->
                    <HyperlinkButton Content="Fermer kDrive"
                                     HorizontalAlignment="Center"
                                     Click="SyncUpToDateHyperlinkButton_Click" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="SyncInProgressMainTemplate">
            <Grid HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  RowSpacing="{StaticResource Infomaniak.Style.Spacing.XL}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <controls:LottiePlayer Grid.Row="0"
                                       UriSource="ms-appx:///Assets/Animations/kDrive-Sync-LIGHT.json"
                                       MaxWidth="230" />

                <StackPanel Grid.Row="1"
                            Spacing="{StaticResource Infomaniak.Style.Spacing.S}">
                    <!-- Title -->
                    <TextBlock Text="Synchronisation en cours"
                               FontSize="16"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Margin="0,14,0,6" />

                    <!-- Description -->
                    <TextBlock Text="Vos fichiers récents sont en train d'être mis à jour."
                               FontSize="13"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               Margin="32,0,32,6" />

                    <!-- Link -->
                    <HyperlinkButton Content="Voir les activités"
                                     HorizontalAlignment="Center"
                                     Click="SyncInProgressHyperlinkButton_Click" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="SyncInPauseMainTemplate">
            <Grid HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  RowSpacing="{StaticResource Infomaniak.Style.Spacing.XL}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <controls:LottiePlayer Grid.Row="0"
                                       UriSource="ms-appx:///Assets/Animations/kDrive-Pause-LIGHT.json"
                                       MaxWidth="230" />

                <StackPanel Grid.Row="1"
                            Spacing="{StaticResource Infomaniak.Style.Spacing.S}">
                    <!-- Title -->
                    <TextBlock Text="Synchronisation en pause"
                               FontSize="16"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Margin="0,14,0,6" />

                    <!-- Description -->
                    <TextBlock Text="La synchronisation est temporairement arrêtée."
                               FontSize="13"
                               HorizontalAlignment="Center"
                               TextWrapping="Wrap"
                               Margin="32,0,32,6" />

                    <!-- Link -->
                    <HyperlinkButton Content="Réactiver la synchronisation"
                                     HorizontalAlignment="Center"
                                     Click="SyncInPauseHyperlinkButton_Click" />
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="SyncOfflineMainTemplate">
            <Grid HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  RowSpacing="{StaticResource Infomaniak.Style.Spacing.XL}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <controls:LottiePlayer Grid.Row="0"
                                       UriSource="ms-appx:///Assets/Animations/kDrive-Offline-LIGHT.json"
                                       MaxWidth="230" />

                <StackPanel Grid.Row="1"
                            Spacing="{StaticResource Infomaniak.Style.Spacing.S}">
                    <!-- Title -->
                    <TextBlock Grid.Row="1"
                               Text="Hors ligne"
                               FontSize="16"
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Margin="0,14,0,6" />

                    <!-- Description -->
                    <TextBlock x:Name="subtitle"
                               Grid.Row="2"
                               TextWrapping="WrapWholeWords"
                               TextAlignment="Center"
                               FontSize="13"
                               HorizontalAlignment="Center"
                               MaxWidth="300">
                        <Run Text="Vos fichiers locaux restent accessibles." />
                        <LineBreak />
                        <Run Text="La synchronisation reprendra automatiquement dès que vous serez reconnecté." />
                    </TextBlock>
                </StackPanel>
            </Grid>
        </DataTemplate>

        <DataTemplate x:Key="SyncLoadingMainTemplate">
            <Grid HorizontalAlignment="Center"
                  VerticalAlignment="Center"
                  RowSpacing="{StaticResource Infomaniak.Style.Spacing.XL}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <controls:ContentLoader Grid.Row="0"
                                        IsLoading="True"
                                        LoaderCornerRadius="{StaticResource Infomaniak.Style.CornerRadius.M}"
                                        Height="130"
                                        Width="180" />

                <StackPanel Grid.Row="1"
                            Spacing="{StaticResource Infomaniak.Style.Spacing.S}">
                    <!-- Title -->
                    <controls:ContentLoader IsLoading="True"
                                            LoaderCornerRadius="{StaticResource Infomaniak.Style.CornerRadius.S}"
                                            Height="{StaticResource Infomaniak.Style.Spacing.L}"
                                            Width="150" />

                    <!-- Description -->
                    <controls:ContentLoader IsLoading="True"
                                            LoaderCornerRadius="{StaticResource Infomaniak.Style.CornerRadius.S}"
                                            Height="{StaticResource Infomaniak.Style.Spacing.L}"
                                            Width="300" />

                    <!-- Link -->
                    <controls:ContentLoader IsLoading="True"
                                            LoaderCornerRadius="{StaticResource Infomaniak.Style.CornerRadius.S}"
                                            Height="{StaticResource Infomaniak.Style.Spacing.L}"
                                            Width="100" />
                </StackPanel>

            </Grid>
        </DataTemplate>

        <local:SyncStatusTemplateSelector x:Key="SyncStatusMainTemplateSelector"
                                          SyncUpToDateTemplate="{StaticResource SyncUpToDateMainTemplate}"
                                          SyncInProgressTemplate="{StaticResource SyncInProgressMainTemplate}"
                                          SyncInPauseTemplate="{StaticResource SyncInPauseMainTemplate}"
                                          SyncOfflineTemplate="{StaticResource SyncOfflineMainTemplate}"
                                          SyncLoadingTemplate="{StaticResource SyncLoadingMainTemplate}" />
    </Page.Resources>
    <Grid Margin="{StaticResource Infomaniak.Style.Thickness.Uniform.L}">
        <Grid.RowDefinitions>
            <!-- Update banner -->
            <RowDefinition Height="Auto" />
            <!-- Main -->
            <RowDefinition Height="*" />
            <!-- Upgrade offer bar -->
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Update Available Banner -->
        <controls:UpdateAvailableBar Grid.Row="0"
                                     Visibility="Collapsed"
                                     Margin="{StaticResource Infomaniak.Style.Thickness.Bottom.M}" />

        <!-- Main content-->
        <Grid Grid.Row="1"
              RowSpacing="{StaticResource Infomaniak.Style.Spacing.L}"
              ColumnSpacing="{StaticResource Infomaniak.Style.Spacing.M}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2.3*" />
                <ColumnDefinition Width="1*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <!-- Sync status bar -->
                <RowDefinition Height="Auto" />
                <!-- Upgrade offer bar -->
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Sync Status Bar -->
            <StackPanel Grid.Column="0"
                        Grid.Row="0"
                        Orientation="Horizontal">
                <TextBlock Style="{StaticResource Infomaniak.Style.TextBlock.SubtitleSl}">
                    <Run Text="Bonjour" />
                    <Run Text="{x:Bind ViewModel.SelectedSync.Drive.User.Name, Mode=OneWay}" />
                </TextBlock>
                <ContentControl ContentTemplateSelector="{StaticResource SyncStatusMessageTemplateSelector}"
                                Content="{x:Bind ViewModel.SelectedSync.SyncStatus,Mode=OneWay}" />
            </StackPanel>
            <!-- State widget -->
            <Border Grid.Column="0"
                    Grid.Row="1"
                    CornerRadius="{StaticResource Infomaniak.Style.CornerRadius.M}"
                    Padding="24">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0"
                                         EndPoint="1,1">
                        <GradientStop Color="{ThemeResource LayerFillColorDefault}"
                                      Offset="0.0" />
                        <GradientStop Color="{ThemeResource LayerFillColorDefault}"
                                      Offset="0.45" />
                        <GradientStop Color="{ThemeResource LayerFillColorDefault}"
                                      Offset="0.55" />
                        <GradientStop Color="{ThemeResource LayerFillColorDefault}"
                                      Offset="1.0" />
                    </LinearGradientBrush>
                </Border.Background>

                <!-- Main content layout -->
                <ContentControl HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                ContentTemplateSelector="{StaticResource SyncStatusMainTemplateSelector}"
                                Content="{x:Bind ViewModel.SelectedSync.SyncStatus,Mode=OneWay}" />
            </Border>

            <!-- Right Side Buttons -->
            <controls:QuickAccess Grid.Row="1"
                                  Grid.Column="1" />
        </Grid>
        <controls:KSuiteUpgradeBar Grid.Row="2"
                                   Grid.ColumnSpan="2"
                                   Visibility="{x:Bind ViewModel.SelectedSync.Drive.IsPaidOffer, Mode=OneWay, Converter={StaticResource BooleanToInvertedVisibilityConverter }}"
                                   Margin="{StaticResource Infomaniak.Style.Thickness.Top.M}" />
    </Grid>
</Page>
